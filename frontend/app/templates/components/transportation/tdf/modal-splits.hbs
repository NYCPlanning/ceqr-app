<div class="eight wide column" style="margin-bottom: 10px;">
  <div class="row">
    <div class="eight wide column">
      <h3 class="ui header left floated">Modal Splits</h3>
      <div class="ui buttons right floated">
        <button class="ui button {{if (eq manualModeSplits true) 'positive'}}" onClick={{action toggleManualModeSplits}}>Manual</button>
        <div class="or"></div>
        <button class="ui button {{if (eq manualModeSplits false) 'positive'}}" onClick={{action toggleCensusTractModeSplits}}>Census Tracts</button>
      </div>
    </div>
  </div>
</div>
<div class="eight wide column">
  <div class="ui small blue button" onClick={{action "toggleSeeCensusTracts"}}>
    {{if seeCensusTracts "Map View" "Table View"}}
  </div>
  
  <Analysis::DataPackageSelector
    style="display: inline-block;"
    @currentPackage={{factor.dataPackage}}
    @availablePackages={{availablePackages}}
    @changeDataPackageAction={{action changeDataPackage}}
  />
</div>

{{#if manualModeSplits}}
  <div class="eight wide column">
    <table class="ui celled table">
      <thead>
        <tr>
          <th class="four wide">
            <span style="color: #2185D0;">Mode</span>
              {{#if editModes}}
                <div class="ui tiny blue button" onClick={{action "toggleEditModes"}}>
                  Ok
                </div>
              {{else}}
                <i class="icon blue pencil alternate" onClick={{action "toggleEditModes"}} style="cursor: pointer;"></i>
              {{/if}}
          </th>
          <th class="four wide">
            All Periods
          </th>
        </tr>
      </thead>
      <tbody class="ui form {{if censusTracksChanging.isRunning "loading"}}">
        {{#each activeModes as |mode|}}
          <Transportation::Tdf::ModalSplits::TableRow
            @mode={{mode}}
            @modeActive=true
            @addActiveMode={{addActiveMode}}
            @removeActiveMode={{removeActiveMode}}
            
            @modeSplits={{modeSplits}}
            
            @showInput={{manualModeSplits}}
            @editModes={{editModes}}
          />
        {{/each}}

        <tr class="warning">
          <td><strong>TOTAL</strong></td>
          <td>
            {{total.percent}} % 
            {{#if (not manualModeSplits)}}
              ({{total.count}})
            {{/if}}  
          </td>
        </tr>
    
        {{#if editModes}}
          {{#each inactiveModes as |mode|}}
            <Transportation::Tdf::ModalSplits::TableRow
              @mode={{mode}}
              @addActiveMode={{addActiveMode}}
              @removeActiveMode={{removeActiveMode}}
              
              @modeSplits={{modeSplits}}
              
              @showInput={{manualModeSplits}}
              @editModes={{editModes}}
            />
          {{/each}}
        {{/if}}
        <tr>
          <td colspan="2">
            <Transportation::Tdf::TableNote 
              @tableName="modalSplits"
              @factor={{factor}}
            />
          </td>
        </tr>
      </tbody>
    </table>
  </div>
{{else}}
  <div class="sixteen wide column">
    <table class="ui celled table">
      <thead>
        <tr>
          <th class="four wide">
            <span style="color: #2185D0;">Mode</span>
              {{#if editModes}}
                <div class="ui tiny blue button" onClick={{action "toggleEditModes"}}>
                  Ok
                </div>
              {{else}}
                <i class="icon blue pencil alternate" onClick={{action "toggleEditModes"}} style="cursor: pointer;"></i>
              {{/if}}
          </th>
          <th class="four wide">
            All Periods
          </th>
          {{#if seeCensusTracts}}
            {{#each analysis.requiredCensusTractsSelection as |geoid|}}
              <th>
                <div class="ui grey label">
                  {{humanize-geoid geoid}}
                </div>
              </th>
            {{/each}}
            {{#each analysis.censusTractsSelection as |geoid|}}
              <th>
                <div class="ui label" style="display: flex;">
                  {{humanize-geoid geoid}}
                  <i class="delete icon" onclick={{action removeCensusTract geoid}}></i>
                </div>
              </th>
            {{/each}}
          {{else}}
            <th class="eight wide">
              Selected Tracts
              {{#each analysis.requiredCensusTractsSelection as |geoid|}}
                <div class="ui grey label">
                  {{humanize-geoid geoid}}
                </div>
              {{/each}}
              {{#each analysis.censusTractsSelection as |geoid|}}
                <div class="ui label">
                  {{humanize-geoid geoid}}
                  <i class="delete icon" onclick={{action removeCensusTract geoid}}></i>
                </div>
              {{/each}}
            </th>
          {{/if}}
        </tr>
      </thead>
      <tbody class="ui form {{if censusTracksChanging.isRunning "loading"}}">
        {{#each activeModes as |mode idx|}}
          <Transportation::Tdf::ModalSplits::TableRow
            @mode={{mode}}
            @modeActive=true
            @addActiveMode={{addActiveMode}}
            @removeActiveMode={{removeActiveMode}}
            
            @modeSplits={{modeSplits}}
            
            @showInput={{manualModeSplits}}
            @editModes={{editModes}}
          >
            {{#if (eq idx 0)}}
              <td rowspan={{add activeModes.length 1}} style="{{if seeCensusTracts "display:none;"}}">
                <Transportation::Tdf::ModalSplits::CensusTractsMap 
                  @analysis={{analysis}}
                  @project={{project}}
                  @factor={{factor}}
                  @addCensusTract={{action addCensusTract}}
                  @removeCensusTract={{action removeCensusTract}}
                />
              </td>
            {{/if}}

            {{#if seeCensusTracts}}
              {{#each censusTractVariables as |tract|}}
                <Transportation::Tdf::ModalSplits::CensusTractTableCell
                  @mode={{mode}}
                  @tract={{tract}}
                />
              {{/each}}
            {{/if}}

          </Transportation::Tdf::ModalSplits::TableRow>
        {{/each}}

        <tr class="warning">
          <td><strong>TOTAL</strong></td>
          <td>
            {{total.percent}} % 
            {{#if (not manualModeSplits)}}
              ({{total.count}})
            {{/if}}  
          </td>

          {{#if seeCensusTracts}}
            {{#each censusTractVariables as |tract|}}
              <Transportation::Tdf::ModalSplits::CensusTractTableCell::Total
                @tract={{tract}}
                @activeModes={{activeModes}}
              />
            {{/each}}
          {{/if}}
        </tr>
    
        {{#if editModes}}
          {{#each inactiveModes as |mode|}}
            <Transportation::Tdf::ModalSplits::TableRow
              @mode={{mode}}
              @addActiveMode={{addActiveMode}}
              @removeActiveMode={{removeActiveMode}}
              
              @modeSplits={{modeSplits}}
              
              @showInput={{manualModeSplits}}
              @editModes={{editModes}}
            />
          {{/each}}
        {{/if}}
        <tr>
          <td colspan="2">
            <Transportation::Tdf::TableNote 
              @tableName="modalSplits"
              @factor={{factor}}
            />
          </td>
          <td colspan="{{if seeCensusTracts (add analysis.censusTractsSelection.length analysis.requiredCensusTractsSelection.length) 1}}"></td>
        </tr>
      </tbody>
    </table>
  </div>
{{/if}}
